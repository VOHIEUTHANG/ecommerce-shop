<html lang="en">
   <head>
      <%- include('../partials/head'); %>
      <link rel="stylesheet" href="/css/login.css" />
   </head>
   <body>
      <%- include('../partials/header',{user,isLoggedIn}) %>
      <div id="root">
         <div class="login">
            <div class="container">
               <div class="login-wrapper">
                  <div class="login-title">Đăng nhập</div>
                  <div class="login-method-wrapper d-flex justify-content-center">
                     <div class="login-method-item">
                        <a href="#">
                           <i class="fa-brands fa-google"></i>
                        </a>
                     </div>
                     <div class="login-method-item">
                        <a href="#">
                           <i class="fa-brands fa-facebook"></i>
                        </a>
                     </div>
                  </div>
                  <div class="divider">
                     <div class="line"></div>
                     <div class="or">OR</div>
                  </div>
                  <div style="text-transform: initial">Đăng nhập với tài khoản:</div>
                  <form action="/api/v1/auth/login" id="form-login" method="post">
                     <div class="row form-container">
                        <div class="col-12">
                           <input
                              class="input-feild"
                              id="username"
                              name="username"
                              placeholder="Tên đăng nhập"
                              type="text"
                           />
                        </div>
                        <div class="col-12">
                           <input
                              class="input-feild"
                              id="password"
                              placeholder="Mật khẩu"
                              type="password"
                              name="password"
                           />
                        </div>
                     </div>
                     <div class="text--underline">Quên mật khẩu?</div>
                     <button type="submit" class="button button-full">LOGIN</button>
                  </form>
                  <div class="more-options">
                     <a href="/register" class="text--underline">Tạo tại khoản</a>
                     <a href="/" class="text--underline">Trở về cửa hàng</a>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <%- include('../partials/footer') %> <%- include('../partials/foot') %>
      <script type="module">
         import { getFormData } from '/js/utils/formDataHandler.js';
         import setLocal from '/js/localstorage.js';
         const validate = new window.JustValidate('#form-login');
         validate
            .addField('#username', [
               {
                  rule: 'required',
                  errorMessage: 'Không được để trống tên đăng nhập !',
               },
            ])
            .addField('#password', [
               {
                  rule: 'required',
                  errorMessage: 'Không được để trống mật khẩu !',
               },
            ])
            .onSuccess(async (event) => {
               const formData = getFormData(event.target);
               try {
                  const { data, status } = await axios.post('/api/v1/auth/login', formData);
                  console.log({ data, status });
                  if (status === 200) {
                     const { title, message } = data;
                     if (title === 'success') {
                        window.location.href = '/';
                     } else {
                        toastr[title](message);
                        if (title === 'success') {
                           const tokens = data.payload;
                           setLocal(tokens);
                        }
                     }
                  }
               } catch (error) {
                  toastr.error('Xảy ra lỗi khi gửi request về server !', error);
               }
            });
      </script>
   </body>
</html>
