<html lang="en">

<head>
    <%- include('../../partials/head-admin') %>
        <link rel="stylesheet" href="/css/global.css" />
        <link rel="stylesheet" href="/css/admin-product.css" />
        <link rel="stylesheet" href="/css/admin-restyled.css" />
        <link rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
        <title>Manage Products</title>
</head>

<body>
    <div id="admin-manage-products">
        <!-- Page Wrapper -->
        <div id="wrapper">
            <!-- Sidebar -->
            <%- include('../../partials/menu-admin'); %>
                <!-- End of Sidebar -->

                <!-- Content Wrapper -->
                <div id="content-wrapper" class="d-flex flex-column">
                    <!-- Main Content -->
                    <div id="content">
                        <!-- Topbar -->
                        <nav class="navbar navbar-expand navbar-light bg-white topbar mb-3 static-top shadow">
                            <!-- Sidebar Toggle (Topbar) -->
                            <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                                <i class="fa fa-bars"></i>
                            </button>

                            <!-- Topbar Search -->
                            <form id="search-wrapper"
                                class=" d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
                                <div class="input-group">
                                    <input type="text" class="form-control bg-light border-0 small"
                                        placeholder="Search for..." aria-label="Search"
                                        aria-describedby="basic-addon2" />
                                    <div class="input-group-append">
                                        <button class="btn btn-primary button" type="button">
                                            <i class="fas fa-search fa-sm" style="z-index: 0"></i>
                                        </button>
                                    </div>
                                </div>
                            </form>

                            <!-- Topbar Navbar -->
                            <ul class="navbar-nav ml-auto">
                                <!-- Nav Item - Search Dropdown (Visible Only XS) -->
                                <li class="nav-item dropdown no-arrow d-sm-none">
                                    <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fas fa-search fa-fw"></i>
                                    </a>
                                    <!-- Dropdown - Messages -->
                                    <div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
                                        aria-labelledby="searchDropdown">
                                        <form class="form-inline mr-auto w-100 navbar-search">
                                            <div class="input-group">
                                                <input type="text" class="form-control bg-light border-0 small"
                                                    placeholder="Search for..." aria-label="Search"
                                                    aria-describedby="basic-addon2" />
                                                <div class="input-group-append">
                                                    <button class="btn btn-primary" type="button">
                                                        <i class="fas fa-search fa-sm"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </li>

                                <!-- Nav Item - Alerts -->
                                <li class="nav-item dropdown no-arrow mx-1">
                                    <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fas fa-bell fa-fw"></i>
                                        <!-- Counter - Alerts -->
                                        <span class="badge badge-danger badge-counter">3+</span>
                                    </a>
                                    <!-- Dropdown - Alerts -->
                                    <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                        aria-labelledby="alertsDropdown">
                                        <h6 class="dropdown-header">Alerts Center</h6>

                                        <a class="dropdown-item text-center small text-gray-500" href="#">Show All
                                            Alerts</a>
                                    </div>
                                </li>

                                <!-- Nav Item - Messages -->
                                <li class="nav-item dropdown no-arrow mx-1">
                                    <a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fas fa-envelope fa-fw"></i>
                                        <!-- Counter - Messages -->
                                        <span class="badge badge-danger badge-counter">7</span>
                                    </a>
                                    <!-- Dropdown - Messages -->
                                    <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                        aria-labelledby="messagesDropdown">
                                        <h6 class="dropdown-header">Message Center</h6>

                                        <a class="dropdown-item text-center small text-gray-500" href="#">Read More
                                            Messages</a>
                                    </div>
                                </li>

                                <div class="topbar-divider d-none d-sm-block"></div>

                                <!-- Nav Item - User Information -->
                                <li class="nav-item dropdown no-arrow">
                                    <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <span class="mr-3 d-none d-lg-inline text-gray-600 small username">
                                            <%=user.name%>
                                        </span>
                                        <img class="img-profile rounded-circle" src="<%= user.avatar %>" />
                                    </a>
                                    <!-- Dropdown - User Information -->
                                    <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                        aria-labelledby="userDropdown">
                                        <a class="dropdown-item" href="/profile">
                                            <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                                            Thông tin
                                        </a>
                                        <a class="dropdown-item" href="/change-password">
                                            <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
                                            Đổi mật khẩu
                                        </a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" href="#" data-toggle="modal"
                                            data-target="#logoutModal">
                                            <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                            Đăng xuất
                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </nav>
                        <!-- Main content -->
                        <div class="container-fluid">
                            <div class="add-product-wrapper d-flex justify-content-center">
                                <button id="btn-addProduct" class="button light">
                                    <i class="fa-solid fa-plus"></i>
                                    <span>Thêm sản phẩm</span>
                                </button>
                            </div>
                            <div class="product-data-container">
                                <table class="table table-bordered align-middle">
                                    <thead class="table-dark">
                                        <tr>
                                            <th scope="col">Tên</th>
                                            <th scope="col">Trạng thái</th>
                                            <th scope="col">Giá</th>
                                            <th scope="col">Thương hiệu</th>
                                            <th scope="col">Loại</th>
                                            <th scope="col">Update</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% productList.forEach((element)=>{ %>
                                            <tr>
                                                <td>
                                                    <div class="product-name">
                                                        <%=element.dataValues.name%>
                                                    </div>
                                                </td>
                                                <td>
                                                    <%=element.dataValues.isSelling%>
                                                </td>
                                                <td>
                                                    <%=element.dataValues.price%>
                                                </td>
                                                <td>
                                                    <%=element.BRAND.dataValues.brandName%>
                                                </td>
                                                <% if(element.product_categories[0] !=undefined){ %>
                                                    <td>
                                                        <% element.product_categories.forEach((category,index)=>{ %>
                                                            <%= index > 0 ? ',': '' %>
                                                            <%=category.CATEGORY.dataValues.name%>   
                                                            
                                                        <% }) %>
                                                    </td>
                                                    <% } else { %>
                                                        <td>Chưa chọn</td>
                                                        <% } %>
                                                            <td>
                                                                <div class="d-flex justify-content-center">
                                                                    <button class="btn-modify-product button light"
                                                                        id="<%=element.dataValues.ID%>"
                                                                        onclick="getOneProduct(this.id)">
                                                                        Chỉnh sửa
                                                                    </button>
                                                                </div>
                                                            </td>
                                            </tr>
                                            <% })%>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <nav aria-label="Page navigation example">
                        <ul class="pagination" id="pagination">
                        </ul>
                    </nav>
                </div>

        </div>
        <div class="modal-custom" id="myModal">
            <div aria-live="polite" aria-atomic="true" class="toast-custom">
                <div class="toast-container position-absolute top-0 end-0 p-3" id="showToast">
                    <!-- Then put toasts within -->
                </div>
            </div>
            <div class="modal-content-custom">
                <div class="close">
                    <i class="ti-close"></i>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">Tên sản phẩm</span>
                    <input type="text" class="form-control" placeholder="Tên sản phẩm" aria-describedby="basic-addon1"
                        id="name" />
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">Giá bán </span>
                    <input type="text" class="form-control" placeholder="Giá bán" aria-label="Giá *1000 đ"
                        aria-describedby="basic-addon1" id="price" />
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">Ngày bắt đầu bán</span>
                    <input type="date" class="form-control" placeholder="" aria-describedby="basic-addon1" id="date" />
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">Thương hiệu</span>
                    <select class="form-select" aria-label="Default select example" id="brand">
                        <%brandList.forEach((element)=>{ %>
                            <option value="<%=element.dataValues.ID%>">
                                <%=element.dataValues.brandName%>
                            </option>
                            <%})%>
                    </select>
                    <span class="input-group-text" id="basic-addon1">Giới tính</span>
                    <select class="form-select" aria-label="Default select example" id="sex">
                        <option value="male">Nam</option>
                        <option value="female">Nữ</option>
                        <option value="both">Unisex</option>
                    </select>
                    <span class="input-group-text" id="basic-addon1">Phân loại</span>
                    <select class="selectpicker my-select" id="category" multiple data-selected-text-format="count > 3" title="Vui lòng chọn">
                        <%categoryList.forEach((element)=>{ %>
                            <option value="<%=element.dataValues.ID%>">
                                <%=element.dataValues.name%>
                            </option>
                            <%})%>
                    </select>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">Trạng thái</span>
                    <input type="range" min="0" max="1" id="isSelling" />
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">Mô tả</span>
                    <textarea class="form-control" rows="3" id="description"></textarea>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">Chi tiết</span>
                    <textarea class="form-control" rows="3" id="detail"></textarea>
                </div>
                <div class="card">
                    <h3 class="card-header text-center font-weight-bold text-uppercase py-4">Chi tiết sản phẩm</h3>
                    <div class="card-body">
                        <div id="table" class="table-editable">
                            <span class="table-add float-right mb-3 mr-2"><a href="#!" class="text-success"><i
                                        class="fas fa-plus fa-2x" aria-hidden="true"></i></a></span>
                            <table class="table table-bordered table-responsive-md table-striped text-center"
                                id="product_items">
                                <thead>
                                    <tr>
                                        <th class="text-center">ID</th>
                                        <th class="text-center">Size</th>
                                        <th class="text-center">Số lượng</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="input-field">
                    <label class="active">Photos</label>
                    <div class="input-images-2" style="padding-top: 0.5rem"></div>
                </div>
                <button id="btn-save" class="button" onclick="createProduct()">Lưu</button>
            </div>

        </div>

        <!-- JavaScript Bundle with Popper -->
        <!-- MDB -->
        <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.4.0/mdb.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
            crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"
            integrity="sha512-odNmoc1XJy5x1TMVMdC7EMs3IVdItLPlCeL5vSUPN2llYKMJ2eByTTAIiiuqLg+GdNr9hF6z81p27DArRFKT7A=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="/js/manageProduct.js"></script>
        <script src="/js/library/image-uploader.min.js"></script>
        <script>
            $(function () {
                $('form').on('submit', function (event) {
                    // Stop propagation
                    event.preventDefault();
                    event.stopPropagation();

                    // Get some vars
                    let $form = $(this),
                        $modal = $('.modal');

                    // Set name and description
                    $modal.find('#display-name span').text($form.find('input[id^="name"]').val());
                    $modal.find('#display-description span').text($form.find('input[id^="description"]').val());

                    // Get the input file
                    let $inputImages = $form.find('input[name^="images"]');
                    if (!$inputImages.length) {
                        $inputImages = $form.find('input[name^="photos"]');
                    }

                    // Get the new files names
                    let $fileNames = $('<ul>');
                    for (let file of $inputImages.prop('files')) {
                        $('<li>', { text: file.name }).appendTo($fileNames);
                    }

                    // Set the new files names
                    $modal.find('#display-new-images').html($fileNames.html());

                    // Get the preloaded inputs
                    let $inputPreloaded = $form.find('input[name^="old"]');

                    if ($inputPreloaded.length) {
                        // Get the ids
                        let $preloadedIds = $('<ul>');
                        for (let iP of $inputPreloaded) {
                            $('<li>', { text: '#' + iP.value }).appendTo($preloadedIds);
                        }

                        // Show the preloadede info and set the list of ids
                        $modal.find('#display-preloaded-images').show().html($preloadedIds.html());
                    } else {
                        // Hide the preloaded info
                        $modal.find('#display-preloaded-images').hide();
                    }
                    const img_file = $('.image-uploader >input')[0].files;
                    console.log(img_file);
                });

                // Input and label handler
                $('input')
                    .on('focus', function () {
                        $(this).parent().find('label').addClass('active');
                    })
                    .on('blur', function () {
                        if ($(this).val() == '') {
                            $(this).parent().find('label').removeClass('active');
                        }
                    });

                // Sticky menu
                let $nav = $('nav'),
                    $header = $('header'),
                    offset = 4 * parseFloat($('body').css('font-size')),
                    scrollTop = $(this).scrollTop();

                // Initial verification
                setNav();

                // Bind scroll
                $(window).on('scroll', function () {
                    scrollTop = $(this).scrollTop();
                    // Update nav
                    setNav();
                });

                function setNav() {
                    if (scrollTop > $header.outerHeight()) {
                        $nav.css({ position: 'fixed', top: offset });
                    } else {
                        $nav.css({ position: '', top: '' });
                    }
                }
            });
        </script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
        <script>

            $('.my-select').selectpicker();
        </script>
</body>

</html>